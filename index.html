<!DOCTYPE html>
<html lang="en">
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta charset="UTF-8">
  <title>Search Video Caption by Arifin Izzah</title>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css" integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous">
  <link rel="stylesheet" href="assets/css/style.css">
</head>
<body>
  <div id="app">
    <section class="hero">
    <div class="jumbotron jumbotron-fluid jumbotron-hero mb-0 pt-0">
      <div class="container">
        <nav class="navbar mb-4">
          <a class="navbar-brand" href="#">Subtify</a>
          <a class="navbar-nav py-1" href="">About</a>
        </nav>
        <div class="hero-content row justify-content-center text-center">
          <div class="col-md-10 col-lg-6">
            <h1 class="display-5">Finding Words Getting Easier</h1>
            <p class="subtitle my-4">
              Increasing productivity can be through anything. One of them is finding
              words in YouTube caption quickly. Then Subtify can be your choice
            </p>
            <a class="btn btn-lg hero-btn" href="#findWords" role="button">Find Words</a>
          </div>
        </div>
      </div>
    </div>
    </section>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1440 320" class="svg-divider">
      <path fill="#f0e6ff" fill-opacity="1" d="M0,96L48,128C96,160,192,224,288,208C384,192,480,96,576,85.3C672,75,768,149,864,170.7C960,192,1056,160,1152,170.7C1248,181,1344,235,1392,261.3L1440,288L1440,320L1392,320C1344,320,1248,320,1152,320C1056,320,960,320,864,320C768,320,672,320,576,320C480,320,384,320,288,320C192,320,96,320,48,320L0,320Z"></path>
    </svg>
    <section class="section-2 py-5">
      <div class="container">
        <div class="row mb-5">
          <div class="col-md-6">
            <h3 class="mb-3" id="findWords">Find Words</h3>
            <div class="form-group">
              <input type="text" v-model="url" class="form-control url" placeholder="Paste Youtube video link here">
              <small class="form-text text-danger" v-if="urlValidation&&url">URL not valid, please insert a valid Youtube video URL</small>
              <small class="form-text text-secondary" v-if="!urlValidation||!url">
                <span class="font-weight-bold">Example: </span>https://www.youtube.com/watch?v=klnvttPfOUM
              </small>
            </div>
            <div class="form-group">
              <input type="text" v-model="kataKunci" class="form-control kataKunci" placeholder="Type your keywords here" :disabled="!url||urlValidation">
              <small class="form-text text-danger" v-if="!url||urlValidation">Please fill Youtube link first!</small>
              <small class="form-text text-secondary" v-else>Example: web</small>
            </div>
            <p class="mb-0 font-weight-bold">Note:</p>
            <ul class="pl-4">
              <li>Youtube video must contains captions or subtitle</li>
              <li>Keywords must contains at least 3 characters</li>
            </ul>
          </div>
          <div class="col-md-6">
            <div class="embed-responsive embed-responsive-16by9">
              <div class="embed-responsive-item video-preview d-flex justify-content-center align-items-center" v-if="!videoId">
                <h3 class="font-weight-normal">Video preview here</h3>
              </div>
              <iframe class="embed-responsive-item videoId" :src="videoId" v-if="videoId" allowfullscreen></iframe>
            </div>
          </div>
        </div>
        <h4 class="mb-3">Result</h4>
        <p class="font-weight-bold mb-1">Video title: {{ videoTitle }}</p>
        <p class="font-weight-bold">Video duration: {{ videoDuration }}</p>
        <button class="bersihkan" @click="bersihkan">Bersihkan</button>
        <button class="pertama" @click="navigasi('first')" :disabled="!paginasi['first']">
          First
        </button>
        <button class="sebelumnya" @click="navigasi('prev')" :disabled="!paginasi['prev']">
          Prev
        </button>
        <button class="selanjutnya" @click="navigasi('next')" :disabled="!paginasi['next']">
          Next
        </button>
        <button class="terakhir" @click="navigasi('last')" :disabled="!paginasi['last']">
          Last
        </button>
        <div class="total mb-5">Total Hasil: {{ paginasi.total }}</div>
        <div class="halaman mb-5">Halaman ke: {{ paginasi.page }}</div>
        <ul class="daftar">
          <li v-for="(hasil, i) in daftarHasil" :key="i" class="mb-3">
            <span v-html="hasil.text"></span>
            <a :href="`${url}&t=${hasil.start}s`" target="_blank">Youtube</a>
          </li>
        </ul>
      </div>
    </section>
  </div>

  <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js" integrity="sha384-OgVRvuATP1z7JjHLkuOU7Xw704+h835Lr+6QL9UvYjZE3Ipu6Tp75j7Bh/kR0JKI" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
  <script src="assets/js/pdebounce.js"></script>
  <script>
      new Vue({
          el: '#app',
          data: {
              url: null,
              kataKunci: '',
              daftarHasil: [],
              paginasi: {
                  first: null,
                  last: null,
                  prev: null,
                  next: null,
                  total: 0,
                  page: null
              },
              urlValidation: false,
              videoId: null,
              videoTitle: null,
              videoDuration: null
          },
          watch: {
              url: pDebounce(async function handleUrl(url) {
                  if (url && url.length >= 3) {
                      await this.validation(url, this.url)
                  } else {
                      this.bersihkanHasilDanPaginasi()
                  }
              }, 250),
              kataKunci: pDebounce(async function handleKeywords(kataKunci) {
                  if (kataKunci && kataKunci.length >= 3) {
                      await this.cari(kataKunci, this.url)
                  } else {
                      this.bersihkanHasilDanPaginasi()
                  }
              }, 250)
          },
          methods: {
              validation(url) {
                  var regExp = /^((?:https?:)?\/\/)?((?:www|m)\.)?((?:youtube\.com|youtu.be))(\/(?:[\w\-]+\?v=|embed\/|v\/)?)([\w\-]+)(\S+)?$/
                  if (regExp.test(url)) {
                      this.urlValidation = false
                      var match = url.match(regExp)
                      if (match && match[5].length == 11) {
                          this.videoId = 'http://www.youtube.com/embed/'+match[5]
                          var ytApi = 'http://gdata.youtube.com/feeds/api/videos/'+ this.videoId +'?v=2&alt=jsonc'
                          console.log(ytApi)
                      } else {
                          this.urlValidation = true
                      }
                  } else {
                      this.urlValidation = true
                  }
              },
              async cari(kataKunci, url, paginasi) {
                  try {
                      const respon = await fetch(
                          paginasi
                              ? paginasi
                              : `https://cari-teks-video-api.vercel.app/api/search?q=${kataKunci}&url=${encodeURIComponent(url)}`
                      ).then(_ => (_.ok ? _.json() : []))
                      this.daftarHasil = respon.data
                      this.paginasi.first = respon.first
                      this.paginasi.last = respon.last
                      this.paginasi.prev = respon.prev
                      this.paginasi.next = respon.next
                      this.paginasi.total = respon.total
                      this.paginasi.page = respon.page
                  } catch (error) {}
              },
              async navigasi(type) {
                  if (!this.paginasi[type]) {
                      return
                  }
                  await this.cari(this.kataKunci, this.url, this.paginasi[type])
              },
              bersihkan() {
                  this.kataKunci = ''
                  this.bersihkanHasilDanPaginasi()
              },
              bersihkanHasilDanPaginasi() {
                  this.daftarHasil = []
                  this.paginasi = {
                      first: null,
                      last: null,
                      prev: null,
                      next: null,
                      total: 0,
                      page: null
                  }
              }
          }
      })
  </script>
</body>
</html>